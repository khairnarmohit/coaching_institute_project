<%- include("./../navbar.ejs") %>
<style>
 .page-header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }

        .section-title {
            color: var(--gov-dark);
            font-size: 1.8rem;
            margin-bottom: 2rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid var(--gov-accent);
            display: inline-block;
        }

        .batches-section {
            margin-bottom: 4rem;
        }

        .batches-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            /* Force 3 columns for consistency on large screens */
            gap: 2rem;
            margin-top: 1.5rem;
        }

        @media (max-width: 1200px) {
            .batches-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .batches-grid {
                grid-template-columns: 1fr;
            }
        }

        .batch-card {
            background: var(--gov-white);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--gov-border);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .batch-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        .batch-header {
            background: var(--gov-dark);
            color: white;
            padding: 1.5rem;
        }

        .batch-header h3 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
        }

        .batch-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-upcoming {
            background-color: #3b82f6;
        }

        .status-ongoing {
            background-color: #10b981;
        }

        .batch-content {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .batch-detail:last-of-type {
            margin-bottom: auto;
            /* Pushes the register button to the bottom */
        }

        .batch-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--gov-border);
        }

        .detail-label {
            color: var(--gov-muted);
            font-weight: 500;
        }

        .detail-value {
            color: var(--gov-text);
            font-weight: 600;
        }

        .fee {
            color: var(--gov-accent);
            font-size: 1.2rem;
        }

        .register-btn {
            display: block;
            width: 100%;
            padding: 0.75rem;
            background: linear-gradient(135deg, var(--gov-accent), #d97706);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
            margin-top: 1rem;
        }

        .register-btn:hover {
            background: linear-gradient(135deg, #d97706, #b45309);
            transform: scale(1.02);
        }

        .info-boxes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 3rem;
        }

        .info-box {
            background: var(--gov-white);
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--gov-accent);
            transition: all 0.3s ease;
        }

        .info-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        .info-box h3 {
            color: var(--gov-dark);
            margin-bottom: 1rem;
        }

        .info-box p {
            color: var(--gov-muted);
        }

        .mode-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
        }

        .mode-online {
            background-color: #dbeafe;
            color: #1d4ed8;
        }

        .mode-offline {
            background-color: #dcfce7;
            color: #047857;
        }

        .mode-indicator::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .mode-online::before {
            background-color: #1d4ed8;
        }

        .mode-offline::before {
            background-color: #047857;
        }

        @media (max-width: 768px) {
            .batches-grid {
                grid-template-columns: 1fr;
            }

            .page-header {
                padding: 2rem 0;
            }

            .page-header h1 {
                font-size: 2rem;
            }
        }
    </style>

<!-- Add / Edit Batch Modal -->
<div class="modal fade" id="addBatchModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title">Add New Batch</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">
        <form action="/admin/add_batch" method="POST" id="batchForm">

          <!-- hidden id for edit -->
          <input type="hidden" name="batch_id" id="batch_id">

          <div class="mb-3">
            <label class="form-label">Batch Title</label>
            <input type="text" name="title" id="title" class="form-control" placeholder="UPSC Foundation 2025">
          </div>

          <div class="mb-3">
            <label class="form-label">Status Label</label>
            <input type="text" name="statusLabel" id="statusLabel" class="form-control" placeholder="Starting Soon">
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Batch Status</label>
              <select name="batch_status" id="batch_status" class="form-select">
                <option value="Upcoming">Upcoming</option>
                <option value="Ongoing">Ongoing</option>
                <option value="Completed">Completed</option>
              </select>
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label">Duration (Months)</label>
              <input type="number" name="duration" id="duration" class="form-control">
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label">Fees</label>
              <input type="number" name="fees" id="fees" class="form-control" placeholder="51000">
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label">Total Strength</label>
              <input type="number" name="total_strength" id="total_strength" class="form-control" placeholder="50">
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label">Mode</label>
              <select name="mode" id="modeSelect" class="form-select">
                <option value="Online">Online</option>
                <option value="Offline">Offline</option>
                <option value="Hybrid" >Hybrid</option>
              </select>
            </div>
          </div>

          <div class="modal-footer">
            <button type="submit" class="btn btn-success">Save Batch</button>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>

<!-- ================= TABLE ================= -->

<main class="container mt-4">
  <section class="batches-section">
    <h2 class="section-title">Upcoming Batches</h2>

    <button class="btn btn-primary float-end mb-3"
      data-bs-toggle="modal"
      data-bs-target="#addBatchModal"
      id="addBatchBtn">
      ➕ Add Batch
    </button>

    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Sr No</th>
          <th>Batch Title</th>
          <th>Status</th>
          <th>Duration</th>
          <th>Fees</th>
          <th>Mode</th>
          <th>Action</th>
        </tr>
      </thead>

      <tbody>
        <% for(var i=0;i<result.length;i++){ %>
        <tr>
          <td><%= i+1 %></td>
          <td><%= result[i].batch_title %></td>
          <td>
            <span class="badge <%= result[i].batch_status === 'Upcoming' ? 'bg-primary' : result[i].batch_status === 'Ongoing' ? 'bg-success' : 'bg-danger' %>">
              <%= result[i].batch_status %>
            </span>
          </td>
          <td><%= result[i].duration %> Months</td>
          <td>₹ <%= result[i].fees %></td>
          <td><%= result[i].mode %></td>
          <td>
            <!-- EDIT BUTTON -->
            <a href="javascript:void(0)"
              class="btn btn-sm btn-primary editBatchBtn"
              data-id="<%= result[i].id %>"
              data-title="<%= result[i].batch_title %>"
              data-status_label="<%= result[i].status_label %>"
              data-status="<%= result[i].batch_status %>"
              data-duration="<%= result[i].duration %>"
              data-fees="<%= result[i].fees %>"
              data-total_strength="<%= result[i].total_strength %>"
              data-mode="<%= result[i].mode %>">
              <i class="fa-solid fa-pen-to-square"></i>
            </a>

            <!-- DELETE -->
            <a href="/admin/delete_batch/<%= result[i].id %>"
              class="btn btn-sm btn-danger"
              onclick="return confirm('Are you sure?')">
              <i class="fa-solid fa-trash"></i>
            </a>
          </td>
        </tr>
        <% } %>
      </tbody>
    </table>
  </section>
</main>

<!-- ================= SCRIPTS ================= -->

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* EDIT BUTTON CLICK */
$(document).on("click", ".editBatchBtn", function () {

  $("#batch_id").val($(this).data("id"));
  $("#title").val($(this).data("title"));
  $("#statusLabel").val($(this).data("status_label"));
  $("#batch_status").val($(this).data("status"));
  $("#duration").val($(this).data("duration"));
  $("#fees").val($(this).data("fees"));
  $("#total_strength").val($(this).data("total_strength"));
  $("#modeSelect").val($(this).data("mode"));

  $(".modal-title").text("Edit Batch");
  $("#batchForm").attr("action", "/admin/update_batch");

  $("#addBatchModal").modal("show");
});

/* ADD BUTTON RESET */
$("#addBatchBtn").on("click", function () {
  $("#batchForm")[0].reset();
  $("#batch_id").val("");
  $(".modal-title").text("Add New Batch");
  $("#batchForm").attr("action", "/admin/add_batch");
});
</script>



<%- include("./../footer.ejs") %>   