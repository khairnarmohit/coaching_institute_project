<%- include('./../navbar.ejs') %>

<style>
:root {
  --gov-dark: #0b1c2d;
  --gov-accent: #f59e0b;
  --gov-bg: #f8fafc;
  --gov-border: #e5e7eb;
  --gov-shadow: 0 12px 32px -6px rgba(0,0,0,0.08);
  --gov-radius: 18px;
}

.gov-header {
  background: var(--gov-dark);
  color: #fff;
  border-radius: var(--gov-radius) var(--gov-radius) 0 0;
  position: relative;
  top: 55px;
}

/* .gov-card {
  border: 1px solid var(--gov-border);
  border-radius: var(--gov-radius);
  box-shadow: var(--gov-shadow);
  background: white;
} */

.message-ellipsis {
  max-width: 220px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ===== DATATABLE BUTTONS ===== */
.dt-top {
  display: flex;
  justify-content: flex-end;
  margin-bottom: 14px;
}

.dt-buttons .btn {
  border-radius: 30px !important;
  padding: 6px 16px !important;
  font-weight: 700 !important;
  border: none !important;
  margin-left: 8px;
  box-shadow: 0 6px 14px rgba(0,0,0,0.15);
}

/* PRINT */
button.buttons-print {
  background: var(--gov-accent) !important;
  color: #000 !important;
  position: relative;
  top: -60px;
}
button.buttons-print:hover {
  background: var(--gov-dark) !important;
  color: var(--gov-accent) !important;
}

/* CSV */
button.buttons-csv {
  background: #16a34a !important;
  color: #fff !important;
  position: relative;
  top: -60px;
}
button.buttons-csv:hover {
  background: #065f46 !important;
}

/* PDF */
button.buttons-pdf {
  background: #dc2626 !important;
  color: #fff !important;
  position: relative;
  top: -60px;
}
button.buttons-pdf:hover {
  background: #7f1d1d !important;
}
</style>

<!-- ===== VIEW MODAL ===== -->
<div class="modal fade" id="viewEnquiryModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content rounded-4 shadow">
      <div class="modal-header bg-dark text-warning">
        <h5 class="modal-title fw-bold">
          <i class="bi bi-envelope-open"></i> Enquiry Details
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body p-4">
        <p><strong>Name:</strong> <span id="viewName"></span></p>
        <p><strong>Email:</strong> <span id="viewEmail"></span></p>
        <p><strong>Mobile:</strong> <span id="viewMobile"></span></p>
        <p><strong>Subject of Interest:</strong> <span id="viewSubject"></span></p>
        <p><strong>Message:</strong></p>
        <div class="border rounded p-3 bg-light" id="viewMessage"></div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="container mt-4">

  <!-- TITLE -->
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h3 class="fw-bold" style="color:var(--gov-dark)">
      <i class="bi bi-trophy" style="color:var(--gov-accent)"></i>
      Enquiries Section
    </h3>
  </div>

  <!-- ðŸ”¹ BUTTONS (OUTSIDE CARD) -->
  <div class="dt-top"></div>

  <!-- TABLE CARD -->
  <div class="gov-card p-3">
    
    <table id="example" class="table table-bordered table-hover table-striped rounded-0 align-middle mb-0">
      <div class="gov-header px-4 py-3 fw-bold">
      <i class="bi bi-list-ul"></i> Enquiries List
    </div>
      <thead class="table-secondary text-center">
        <tr>
          <th>Sr.No</th>
          <th>Name</th>
          <th>Email</th>
          <th>Mobile</th>
          <!-- <th hidden>Subject of interest</th> -->
          <th>Message</th>
          <th width="160">Action</th>
        </tr>
      </thead>

      <tbody>
      <% for(var i=0;i<result.length;i++){ %>
        <tr>
          <td class="text-center"><%= i+1 %></td>
          <td><%= result[i].name %></td>
          <td><%= result[i].email %></td>
          <td><%= result[i].mo_number %></td>
          <!-- <td hidden><%= result[i].subject %></td> -->
          <td class="message-ellipsis"><%= result[i].message %></td>
          <td class="text-center">
            <a class="btn btn-sm btn-warning"
               data-bs-toggle="modal"
               data-bs-target="#viewEnquiryModal"
               onclick='viewEnquiry(
                 "<%= result[i].name %>",
                 "<%= result[i].email %>",
                 "<%= result[i].mo_number %>",
                 "<%= result[i].subject %>",
                 "<%= result[i].message %>"
               )'>
              <i class="bi bi-eye"></i>
            </a>

            <a href="/admin/delete_enquiry/<%= result[i].id %>"
               class="btn btn-sm btn-danger"
               onclick="return confirm('Delete this enquiry?')">
              <i class="fa fa-trash"></i>
            </a>
          </td>
        </tr>
      <% } %>
      </tbody>
    </table>
  </div>
</div>

<script>
function viewEnquiry(name, email, mobile, subject, message) {
  document.getElementById('viewName').textContent = name;
  document.getElementById('viewEmail').textContent = email;
  document.getElementById('viewMobile').textContent = mobile;
  document.getElementById('viewSubject').textContent = subject;
  document.getElementById('viewMessage').innerText = message;
}
</script>

<!-- ===== SCRIPTS ===== -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.dataTables.min.css">

<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.print.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

<script>
$(document).ready(function () {
  $('#example').DataTable({
    dom: '<"dt-top"B>rtip',
    buttons: [
      { extend: 'print', text: 'Print' },
      { extend: 'csv', text: 'CSV' },
      { extend: 'pdf', text: 'PDF' }
    ]
  });
});
</script>

<%- include('./../footer.ejs') %>
